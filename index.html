<!DOCTYPE html>
<html>
<head>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        canvas {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        #restartButton, #fullscreenButton {
            position: fixed;
            font-size: 30px;
        }
        #restartButton {
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
        }
        #fullscreenButton {
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <button id="restartButton">Restart</button>
    <button id="fullscreenButton">&#x1F5D6;</button>
    <script>
        const BASE_WIDTH = 800;
        const BASE_HEIGHT = 600;
        let scale = 1;

        const canvas = document.getElementById('gameCanvas');
        const context = canvas.getContext('2d');

        const restartButton = document.getElementById('restartButton');
        const fullscreenButton = document.getElementById('fullscreenButton');

        let leftPlayerY = BASE_HEIGHT / 2;
        let rightPlayerY = BASE_HEIGHT / 2;
        let upArrow = false;
        let downArrow = false;
        let wKey = false;
        let sKey = false;
        let dKey = false;
        let rightArrow = false;
        let score1 = 0;
        let score2 = 0;
        let boost1 = true;
        let boost2 = true;

        let touchStartY1 = null;
        let touchStartY2 = null;

        const ball = new Image();
        ball.src = 'pelota.png';
        const ballPower = new Image();
        ballPower.src = 'pelotapower.png';
        const ballPower1 = new Image();
        ballPower1.src = 'pelotapower1.png';
        const ballPower2 = new Image();
        ballPower2.src = 'pelotapower2.png';
        const player1 = new Image();
        player1.src = 'jugador1.png';
        const player2 = new Image();
        player2.src = 'jugador2.png';

        const ballObj = {
            x: BASE_WIDTH / 2,
            y: BASE_HEIGHT / 2,
            dx: 4,
            dy: 4,
            radius: 10,
            image: ball
        };
        function drawBall() {
            context.drawImage(ballObj.image, ballObj.x - ballObj.radius, ballObj.y - ballObj.radius, ballObj.radius * 2, ballObj.radius * 2);
        }

        function drawPlayers() {
            context.drawImage(player1, 0, leftPlayerY - 50, 20, 100);
            context.drawImage(player2, BASE_WIDTH - 20, rightPlayerY - 50, 20, 100);
        }

        function drawScore() {
            context.font = '30px Arial';
            context.fillText(score1, BASE_WIDTH / 4, 50);
            context.fillText(score2, BASE_WIDTH * 3 / 4, 50);
        }

        function animate() {
            context.clearRect(0, 0, BASE_WIDTH, BASE_HEIGHT);
            drawBall();
            drawPlayers();
            drawScore();

            if (wKey && leftPlayerY > 50) {
                leftPlayerY -= 5;
            }
            if (sKey && leftPlayerY < BASE_HEIGHT - 50) {
                leftPlayerY += 5;
            }
            if (upArrow && rightPlayerY > 50) {
                rightPlayerY -= 5;
            }
            if (downArrow && rightPlayerY < BASE_HEIGHT - 50) {
                rightPlayerY += 5;
            }

            ballObj.x += ballObj.dx;
            ballObj.y += ballObj.dy;

            if (ballObj.y + ballObj.dy < ballObj.radius || ballObj.y + ballObj.dy > BASE_HEIGHT - ballObj.radius) {
                ballObj.dy = -ballObj.dy;
            }

            if (ballObj.x < 20) {
                if (ballObj.y > leftPlayerY - 50 && ballObj.y < leftPlayerY + 50) {
                    ballObj.dx = -ballObj.dx;
                    if (dKey && boost1) {
                        ballObj.dx *= 3;
                        ballObj.image = ballPower;
                        boost1 = false;
                    }
                } else if (ballObj.x < -ballObj.radius) {
                    score2++;
                    if (score2 === 7) {
                        restartButton.style.display = 'block';
                        return;
                    }
                    reset();
                }
            }

            if (ballObj.x > BASE_WIDTH - 20) {
                if (ballObj.y > rightPlayerY - 50 && ballObj.y < rightPlayerY + 50) {
                    ballObj.dx = -ballObj.dx;
                    if (rightArrow && boost2) {
                        ballObj.dx *= 3;
                        ballObj.image = ballPower;
                        boost2 = false;
                    }
                } else if (ballObj.x > BASE_WIDTH + ballObj.radius) {
                    score1++;
                    if (score1 === 7) {
                        restartButton.style.display = 'block';
                        return;
                    }
                    reset();
                }
            }

            requestAnimationFrame(animate);
        }

        function reset() {
            ballObj.x = BASE_WIDTH / 2;
            ballObj.y = BASE_HEIGHT / 2;
            ballObj.dx = 4;
            ballObj.dy = 4;
            ballObj.image = ball;
            leftPlayerY = BASE_HEIGHT / 2;
            rightPlayerY = BASE_HEIGHT / 2;
            boost1 = true;
            boost2 = true;
        }

        function resizeCanvas() {
            const width = window.innerWidth;
            const height = window.innerHeight;
            scale = Math.min(width / BASE_WIDTH, height / BASE_HEIGHT);
            canvas.width = BASE_WIDTH * scale;
            canvas.height = BASE_HEIGHT * scale;
            context.scale(scale, scale);
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        window.addEventListener('keydown', function(event) {
            switch (event.key) {
                case 'ArrowUp':
                    upArrow = true;
                    break;
                case 'ArrowDown':
                    downArrow = true;
                    break;
                case 'w':
                    wKey = true;
                    break;
                case 's':
                    sKey = true;
                    break;
                case 'd':
                    dKey = true;
                    break;
                case 'ArrowRight':
                    rightArrow = true;
                    break;
            }
        });

        window.addEventListener('keyup', function(event) {
            switch (event.key) {
                case 'ArrowUp':
                    upArrow = false;
                    break;
                case 'ArrowDown':
                    downArrow = false;
                    break;
                case 'w':
                    wKey = false;
                    break;
                case 's':
                    sKey = false;
                    break;
                case 'd':
                    dKey = false;
                    break;
                case 'ArrowRight':
                    rightArrow = false;
                    break;
            }
        });

        restartButton.addEventListener('click', function() {
            score1 = 0;
            score2 = 0;
            restartButton.style.display = 'none';
            animate();
        });

        fullscreenButton.addEventListener('click', function() {
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                document.documentElement.requestFullscreen();
            }
        });

        canvas.addEventListener('touchstart', function(event) {
            event.preventDefault();
            const touch = event.touches[0];
            const touchX = touch.clientX;
            const touchY = touch.clientY;

            if (touchX < window.innerWidth / 2) {
                touchStartY1 = touchY;
            } else {
                touchStartY2 = touchY;
            }
        });

        canvas.addEventListener('touchmove', function(event) {
            event.preventDefault();
            const touch = event.touches[0];
            const touchX = touch.clientX;
            const touchY = touch.clientY;

            if (touchX < window.innerWidth / 2 && touchStartY1 !== null) {
                const deltaY = (touchY - touchStartY1) / scale;
                leftPlayerY += deltaY;
                touchStartY1 = touchY;
            } else if (touchStartY2 !== null) {
                const deltaY = (touchY - touchStartY2) / scale;
                rightPlayerY += deltaY;
                touchStartY2 = touchY;
            }
        });

        canvas.addEventListener('touchend', function(event) {
            if (event.touches.length === 0) {
                touchStartY1 = null;
                touchStartY2 = null;
            }
        });

        animate();
    </script>
</body>
</html>
